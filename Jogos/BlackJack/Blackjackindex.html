<!doctype html>
<html lang="pt-BR">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Blackjack</title>
  <style>
    :root{--bg:#071029;--card:#f8fafc;--accent:#06b6d4;--accent-2:#10b981;--muted:rgba(248,250,252,0.7)}
    *{box-sizing:border-box}
    body{font-family:Inter, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;min-height:100vh;margin:0;background:linear-gradient(180deg,#041025 0%, #071029 100%);color:var(--card);display:flex;align-items:center;justify-content:center;padding:20px}
    .wrap{width:1000px;max-width:98%;background:rgba(255,255,255,0.03);border-radius:14px;padding:18px;box-shadow:0 10px 40px rgba(2,6,23,0.6)}
    header{display:flex;align-items:center;justify-content:space-between;margin-bottom:10px}
    h1{font-size:20px;margin:0}
    .board{display:flex;gap:16px}
    .panel{flex:1;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));padding:14px;border-radius:10px}
    .controls{display:flex;gap:8px;align-items:center;margin-top:12px}
    .cards{display:flex;gap:10px;min-height:140px;align-items:flex-start}
    .card{width:84px;height:120px;border-radius:8px;background:white;color:#071029;display:flex;flex-direction:column;justify-content:space-between;padding:8px;font-weight:700;box-shadow:0 8px 18px rgba(2,6,23,0.45);transform-origin:center;transition:transform .35s ease,opacity .35s ease}
    .card.red{color:#c92a2a}
    .card.hidden{background:linear-gradient(180deg,#07324a,#03435d);color:transparent}
    .deal-anim{animation:deal 420ms ease both}
    @keyframes deal{from{transform:translateY(-18px) scale(.95);opacity:0}to{transform:none;opacity:1}}
    .info{font-size:14px;color:var(--muted)}
    .big{font-size:18px;font-weight:800}
    .btn{background:var(--accent-2);border:none;padding:10px 14px;border-radius:8px;color:white;font-weight:700;cursor:pointer}
    .btn.secondary{background:transparent;border:1px solid rgba(255,255,255,0.08)}
    .muted{color:var(--muted)}
    .footer{margin-top:12px;color:var(--muted);font-size:13px}
    .scoreboard{display:flex;gap:12px;align-items:center}
    .score-pill{background:rgba(255,255,255,0.03);padding:8px 10px;border-radius:8px}
    .bet-area{display:flex;flex-direction:column;gap:8px}
    input[type=number]{padding:8px;border-radius:8px;border:1px solid rgba(255,255,255,0.06);background:rgba(0,0,0,0.2);color:var(--card)}
    .presets{display:flex;gap:8px}
    .sound-toggle{display:flex;align-items:center;gap:6px}
    .center{display:flex;align-items:center;gap:8px}
    .result{margin-top:10px;padding:10px;border-radius:8px;background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01));font-weight:700}
    @media(max-width:860px){.board{flex-direction:column}}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <h1>Blackjack</h1>
      <div class="scoreboard">
        <div class="score-pill">Saldo: <span id="balanceTxt">R$ 1.000</span></div>
        <div class="score-pill">Vit√≥rias: <span id="wins">0</span></div>
        <div class="score-pill">Derrotas: <span id="losses">0</span></div>
        <div class="score-pill">Empates: <span id="pushes">0</span></div>
      </div>
    </header>

    <div class="board">
      <div class="panel">
        <strong>Dealer (Computador)</strong>
        <div id="dealer-cards" class="cards" style="margin-top:10px"></div>
        <div style="margin-top:10px">Soma: <span id="dealer-sum">-</span></div>
      </div>

      <div class="panel">
        <strong>Jogador</strong>
        <div id="player-cards" class="cards" style="margin-top:10px"></div>
        <div style="margin-top:10px">Soma: <span id="player-sum">0</span></div>

        <div class="bet-area">
          <div class="center">
            <label class="muted">Aposta m√≠nima:</label>
            <div class="big" style="margin-left:8px">R$ <span id="minBet">50</span></div>
          </div>

          <div class="center">
            <label class="muted">Aposta atual:</label>
            <input id="betInput" type="number" min="50" step="10" value="50" style="width:120px;margin-left:8px" />
            <div class="presets" style="margin-left:8px">
              <button class="btn secondary" data-bet="50">R$50</button>
              <button class="btn secondary" data-bet="100">R$100</button>
              <button class="btn secondary" data-bet="200">R$200</button>
            </div>
          </div>

          <div class="controls">
            <button id="dealBtn" class="btn">Iniciar rodada</button>
            <button id="hitBtn" class="btn secondary">Pedir (Hit)</button>
            <button id="standBtn" class="btn secondary">Parar (Stand)</button>
            <button id="newBtn" class="btn secondary">Reiniciar jogo</button>
            <div class="sound-toggle">
              <input type="checkbox" id="soundToggle" checked />
              <label for="soundToggle" class="muted">Som</label>
            </div>
          </div>

        </div>

        <div id="message" class="result">Ajuste a aposta e clique em <strong>Iniciar rodada</strong>.</div>
      </div>
    </div>

    <div class="footer">Feito para o EPA por @cardozzl_ </div>
  </div>

  <script>
    // Configura√ß√µes iniciais
    const START_BALANCE = 1000; // saldo inicial escolhido
    const MIN_BET = 50; // valor m√≠nimo escolhido

    // Deck
    const suits = ['‚ô†','‚ô•','‚ô¶','‚ô£'];
    const ranks = ['A','2','3','4','5','6','7','8','9','10','J','Q','K'];

    function createDeck(){
      const deck = [];
      for(const s of suits){
        for(const r of ranks){
          let value = 0;
          if(r === 'A') value = 11;
          else if(['J','Q','K'].includes(r)) value = 10;
          else value = parseInt(r,10);
          deck.push({suit:s,rank:r,value});
        }
      }
      return deck;
    }

    function shuffle(deck){
      for(let i = deck.length - 1; i > 0; i--){
        const j = Math.floor(Math.random() * (i + 1));
        [deck[i], deck[j]] = [deck[j], deck[i]];
      }
      return deck;
    }

    // Estado
    let deck = [];
    let player = [];
    let dealer = [];
    let gameActive = false;
    let balance = START_BALANCE;
    let currentBet = MIN_BET;

    // Elementos
    const dealerCardsEl = document.getElementById('dealer-cards');
    const playerCardsEl = document.getElementById('player-cards');
    const playerSumEl = document.getElementById('player-sum');
    const dealerSumEl = document.getElementById('dealer-sum');
    const messageEl = document.getElementById('message');
    const hitBtn = document.getElementById('hitBtn');
    const standBtn = document.getElementById('standBtn');
    const dealBtn = document.getElementById('dealBtn');
    const newBtn = document.getElementById('newBtn');
    const betInput = document.getElementById('betInput');
    const minBetEl = document.getElementById('minBet');
    const balanceTxt = document.getElementById('balanceTxt');
    const winsEl = document.getElementById('wins');
    const lossesEl = document.getElementById('losses');
    const pushesEl = document.getElementById('pushes');
    const soundToggle = document.getElementById('soundToggle');

    // Placar persistente (localStorage)
    const scoreKey = 'bj_score_v1';
    function loadScore(){
      const raw = localStorage.getItem(scoreKey);
      if(raw) return JSON.parse(raw);
      return {wins:0,losses:0,pushes:0};
    }
    function saveScore(obj){ localStorage.setItem(scoreKey, JSON.stringify(obj)); }
    const score = loadScore();

    // Sons via WebAudio (sintetizados)
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq, duration, type='sine', gain=0.08){
      if(!soundToggle.checked) return;
      const o = audioCtx.createOscillator();
      const g = audioCtx.createGain();
      o.type = type; o.frequency.value = freq;
      g.gain.value = gain;
      o.connect(g); g.connect(audioCtx.destination);
      o.start();
      setTimeout(()=>{ o.stop(); }, duration);
    }
    function playSound(name){
      if(!soundToggle.checked) return;
      if(name === 'deal') playTone(900, 60, 'sine', 0.05);
      if(name === 'hit') playTone(1300, 50, 'triangle', 0.06);
      if(name === 'win') { playTone(1000, 160, 'sine', 0.08); setTimeout(()=>playTone(1400,120,'sine',0.07),120); }
      if(name === 'lose') { playTone(260, 140, 'sawtooth', 0.07); }
      if(name === 'blackjack') { playTone(1200, 160, 'sine', 0.09); setTimeout(()=>playTone(1500,140,'sine',0.08),140); }
    }

    // Inicializa UI
    function updateUI(){
      balanceTxt.textContent = `R$ ${balance.toLocaleString('pt-BR')}`;
      minBetEl.textContent = MIN_BET;
      betInput.min = MIN_BET;
      betInput.value = currentBet;
      winsEl.textContent = score.wins;
      lossesEl.textContent = score.losses;
      pushesEl.textContent = score.pushes;
      hitBtn.disabled = !gameActive;
      standBtn.disabled = !gameActive;
      dealBtn.disabled = gameActive || currentBet > balance || currentBet < MIN_BET;
    }

    // Cartas para DOM
    function cardToElement(card, hidden=false){
      const el = document.createElement('div');
      el.className = 'card';
      if(card && (card.suit === '‚ô•' || card.suit === '‚ô¶')) el.classList.add('red');
      if(hidden){ el.classList.add('hidden'); el.textContent = '\n\nüÇ†'; return el; }
      el.innerHTML = `<div>${card.rank}</div><div style="font-size:14px">${card.suit}</div>`;
      return el;
    }

    function render(dealerHideSecond=true){
      dealerCardsEl.innerHTML = '';
      playerCardsEl.innerHTML = '';
      dealer.forEach((c, i) => {
        const hidden = (dealerHideSecond && !gameActive && i === 1);
        const el = cardToElement(c, hidden);
        el.classList.add('deal-anim');
        dealerCardsEl.appendChild(el);
      });
      player.forEach(c => { const el = cardToElement(c); el.classList.add('deal-anim'); playerCardsEl.appendChild(el); });
      playerSumEl.textContent = calcSum(player);
      dealerSumEl.textContent = gameActive ? '??' : calcSum(dealer);
      updateUI();
    }

    // Soma com ajuste de √Ås
    function calcSum(hand){
      let sum = 0; let aces = 0;
      for(const c of hand){ sum += c.value; if(c.rank === 'A') aces++; }
      while(sum > 21 && aces > 0){ sum -= 10; aces--; }
      return sum;
    }

    // L√≥gica
    function startRound(){
      // valida aposta
      currentBet = Math.max(MIN_BET, Math.floor(Number(betInput.value) || MIN_BET));
      if(currentBet > balance){ messageEl.textContent = 'Aposta maior que o saldo dispon√≠vel.'; return; }
      if(currentBet < MIN_BET){ messageEl.textContent = `A aposta m√≠nima √© R$ ${MIN_BET}.`; return; }

      deck = shuffle(createDeck()); player = []; dealer = [];
      gameActive = true;
      // Retira aposta do saldo temporariamente
      balance -= currentBet;
      playSound('deal');
      // Distribui: P D P D
      player.push(deck.pop()); dealer.push(deck.pop()); player.push(deck.pop()); dealer.push(deck.pop());
      render(true);
      messageEl.textContent = 'Rodada iniciada. Voc√™ pode pedir (Hit) ou parar (Stand).';

      // Verifica blackjack natural
      const p = calcSum(player); const d = calcSum(dealer);
      if(p === 21 || d === 21){
        // espera uma pequena anima√ß√£o
        setTimeout(()=>{ resolveRound(); }, 600);
      }
      updateUI();
    }

    function hit(){
      if(!gameActive) return;
      player.push(deck.pop());
      playSound('hit');
      render(true);
      const sum = calcSum(player);
      if(sum > 21){
        // jogador estourou
        setTimeout(()=>{ resolveRound(); }, 400);
      }
    }

    function stand(){
      if(!gameActive) return;
      // Dealer compra at√© 17 (incluindo soft 17 tratado como >=17 stop)
      while(calcSum(dealer) < 17){ dealer.push(deck.pop()); playSound('deal'); }
      setTimeout(()=>{ resolveRound(); }, 400);
    }

    function resolveRound(){
      gameActive = false; render(false);
      const p = calcSum(player); const d = calcSum(dealer);

      // Resultado e pagamento
      // Blackjack natural (2 cartas) paga 3:2
      const playerBJ = (p === 21 && player.length === 2);
      const dealerBJ = (d === 21 && dealer.length === 2);

      if(p > 21){ // jogador bust
        messageEl.textContent = `Voc√™ estourou (${p}). Computador vence.`;
        playSound('lose'); score.losses++;
      } else if(d > 21){ // dealer bust
        messageEl.textContent = `Computador estourou (${d}). Voc√™ vence! Ganhou R$ ${currentBet}.`;
        balance += currentBet * 2; playSound('win'); score.wins++;
      } else if(playerBJ && !dealerBJ){
        const pay = Math.floor(currentBet * 2.5); // 3:2 (aprox)
        messageEl.textContent = `Blackjack! Voc√™ venceu e recebe R$ ${pay - currentBet} (3:2).`;
        balance += pay; playSound('blackjack'); score.wins++;
      } else if(dealerBJ && !playerBJ){
        messageEl.textContent = `Dealer tem Blackjack (${d}). Computador vence.`; playSound('lose'); score.losses++;
      } else if(p === d){
        messageEl.textContent = `Empate: ${p} x ${d}. Sua aposta √© devolvida.`; balance += currentBet; score.pushes++; playSound('deal');
      } else if(p > d){
        messageEl.textContent = `Voc√™ venceu: ${p} x ${d}. Ganhou R$ ${currentBet}.`;
        balance += currentBet * 2; playSound('win'); score.wins++;
      } else {
        messageEl.textContent = `Computador venceu: ${d} x ${p}.`;
        playSound('lose'); score.losses++;
      }

      // atualiza placar e UI
      saveScore(score);
      updateUI();

      // Se saldo for 0, bloqueia in√≠cio at√© reiniciar
      if(balance < MIN_BET){ messageEl.textContent += ' Saldo insuficiente para nova aposta. Clique em Reiniciar jogo.'; }
    }

    // Eventos UI
    dealBtn.addEventListener('click', startRound);
    hitBtn.addEventListener('click', hit);
    standBtn.addEventListener('click', stand);
    newBtn.addEventListener('click', ()=>{
      // reinicia tudo
      balance = START_BALANCE; score.wins=0; score.losses=0; score.pushes=0; saveScore(score); updateUI(); messageEl.textContent = 'Jogo reiniciado. Ajuste a aposta e comece novamente.'; player=[]; dealer=[]; render(false);
    });

    // Preset bets
    document.querySelectorAll('.presets button').forEach(b => b.addEventListener('click', (e)=>{
      const v = Number(e.currentTarget.dataset.bet); betInput.value = v; currentBet = v; updateUI();
    }));

    betInput.addEventListener('change', ()=>{
      currentBet = Math.max(MIN_BET, Math.floor(Number(betInput.value) || MIN_BET)); updateUI();
    });

    // Inicializa
    updateUI(); render(false);

    
  </script>
</body>
</html>